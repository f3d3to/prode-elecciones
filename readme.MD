# ğŸ—³ï¸ PRODE ELECTORAL LEGISLATIVO 2025 â€” EspecificaciÃ³n reformulada y unificada

---

## 1ï¸âƒ£ Experiencia del usuario â€” quÃ© ve y quÃ© responde

### Inicio e identificaciÃ³n

El usuario ingresa al sitio y ve una **portada con cuenta regresiva** hasta el cierre del prode. Las acciones visibles son â€œJugarâ€, â€œResultadosâ€ y â€œRankingâ€; la pestaÃ±a â€œAdministraciÃ³nâ€ estÃ¡ oculta y solo accesible a staff.
Al presionar â€œJugarâ€, aparece un modal de **identificaciÃ³n mÃ­nima** con dos campos obligatorios:

* **Nombre de usuario** (texto libre UTF-8).
* **Email** (Ãºnico y con formato vÃ¡lido).

No hay registro ni contraseÃ±as. Si el correo ya participÃ³, se **precarga** su pronÃ³stico y puede **editarlo hasta el deadline**.

### PestaÃ±a â€œNacionalâ€

Presenta las preguntas **centrales** del prode, ligadas al puntaje principal.
El usuario debe:

* Ordenar el **Top-3** de fuerzas (desde la lista de fuerzas definidas en `fuerzas.json`).
* Asignar **porcentajes por fuerza nacional** (la suma debe ser â‰ˆ 100 %).
* Estimar el **porcentaje de participaciÃ³n**.
* Calcular el **margen entre 1.Âº y 2.Âº**.
* Completar el **voto blanco/nulo/impugnado** y, opcionalmente, el **total de votos**.

El frontend valida rangos (0â€“100 %) y coherencia, mostrando advertencias pero sin bloquear el avance.

### PestaÃ±a â€œProvincialesâ€

El usuario carga pronÃ³sticos para 8â€“12 provincias clave (extraÃ­das de `provincias.json`).
Para cada provincia:

* % por fuerza (solo las predefinidas).
* Fuerza dominante (selecciÃ³n Ãºnica).

La UI impide ingresar nombres de fuerzas o provincias no registradas.

### PestaÃ±a â€œBonus y especialesâ€

Campos de puntaje secundario:

* Provincia mÃ¡s reÃ±ida.
* Provincia que cambia de ganador respecto 2023.
* Donde **FIT** saca mayor %.
* Donde **LLA** mÃ¡s crece.
* Donde **Fuerza Patria** obtiene mayor %.

### PestaÃ±a â€œResumen y envÃ­oâ€

Muestra todo lo ingresado, el estado de sincronizaciÃ³n (â€œGuardado / Pendienteâ€), y un botÃ³n **Guardar** activo solo antes del cierre.

### Post-deadline

Cuando la cuenta regresiva llega a cero, las pestaÃ±as se vuelven **solo lectura** y aparece el cartel **â€œElecciones finalizadasâ€**.
El jugador aÃºn puede ver su pronÃ³stico, pero no modificarlo.

### Resultados y ranking

Antes de la publicaciÃ³n oficial: mensaje **â€œA la espera de resultados oficialesâ€**.
Luego:

* Panel **Nacional** con porcentajes reales.
* Panel **Provincial** con tabla de resultados por distrito.
* **Ranking general** con posiciÃ³n, usuario, puntaje total, medallas, bonus y fecha de envÃ­o.

El buscador permite filtrar por nombre o email.

### AdministraciÃ³n (staff con login de sesiÃ³n)

Acceso oculto en menÃº. Solo visible para usuarios con credenciales definidas en base o variables de entorno. Permite:

* Subir resultados oficiales.
* Ejecutar el **reprocesamiento de puntajes**. (El puntaje se recalcula automÃ¡ticamente al publicar resultados. El botÃ³n de reprocesamiento permite forzar un recÃ¡lculo manual (Ãºtil si se corrigen resultados).)
* Reintentar sincronizaciones con Google Sheets.
* Exportar ranking a CSV.
* Ver mÃ©tricas del sistema (deadline, conteos, sincronizaciÃ³n, estado del cronÃ³metro).

---

## 2ï¸âƒ£ Flujo cronolÃ³gico del usuario

1. Ingresa al **inicio** y observa la cuenta regresiva.
2. Toca **Jugar**, completa nombre y email.
3. Avanza por **Nacional â†’ Provinciales â†’ Bonus**, completando cada secciÃ³n.
4. Revisa el **Resumen** y presiona **Guardar** antes del `DEADLINE`.
5. Si intenta guardar luego del cierre, ve â€œElecciones finalizadasâ€.
6. Cuando se publiquen resultados, puede acceder a **Resultados**, **Puntaje bonus** y **Ranking general**.

---

## 3ï¸âƒ£ Funcionamiento tÃ©cnico â€” soporte del flujo

* **Archivos estÃ¡ticos** (`fuerzas.json`, `provincias.json`) definen los Ãºnicos valores vÃ¡lidos; si un valor no coincide, el backend rechaza el envÃ­o.
* **Deadline** en variable de entorno (`DEADLINE` / `VITE_DEADLINE`, ISO-UTC); el **backend es autoridad final**.
* **Dual-write:** cada â€œGuardarâ€ persiste en **base relacional** (fuente de verdad) y refleja en **Google Sheets** (`pronosticos`).

  * Si falla Sheets, se marca `sync_pending = true` y se puede reintentar desde AdministraciÃ³n.
* **Unicidad por email:** antes del deadline, el envÃ­o **actualiza** si ya existe; despuÃ©s del cierre, la API responde 403.
* **Resultados oficiales:** cargados por staff; se guardan en base y en la hoja `resultados_oficiales`.
* **Scoring:** tras publicar resultados, el backend calcula **puntaje principal** (error absoluto sobre campos â€œimportantesâ€) y **bonus** (reglas fijas), y expone `/api/score` (estructuras reducidas, sin payloads sensibles).

---

## 4ï¸âƒ£ Diagrama integral del sistema

```
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚          Usuario             â”‚
             â”‚ (Inicio â†’ Jugar â†’ Prode)     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                  [ SPA Vue Frontend ]
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚                 â”‚
  GET /api/predictions/mine â”‚  POST /api/predictions (deadline check)
 (precarga por email)        â”‚
          â”‚                 â”‚
          â–¼                 â–¼
     [BD principal]  â‡†  [Google Sheets: pronosticos]
                            â”‚
                     (sync_pending si falla)
                            â”‚
                            â–¼
            [Admin login â†’ POST /api/results]
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                   â–¼
 [BD: resultados_oficiales]       [Sheets: resultados_oficiales]
                            â”‚
                  Script de scoring backend
                            â–¼
          [BD: ranking_calculado] â‡† [Sheets: ranking]
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                   â–¼
 [SPA: Resultados]                   [SPA: Ranking pÃºblico]
```

---

## 5ï¸âƒ£ TecnologÃ­as y arquitectura (backend y frontend)

### Backend (Django)

* **Framework**: **Django 5** con **Django REST Framework** para la API.
* **Base de datos**: **PostgreSQL** (o SQLite en desarrollo).
* **AutenticaciÃ³n administrativa**: **sesiones Django** con CSRF activo para la pestaÃ±a â€œAdministraciÃ³nâ€; usuarios `is_staff`.
* **DocumentaciÃ³n**: **drf-spectacular** (OpenAPI JSON y UI de docs).
* **SincronizaciÃ³n con Google Sheets**: **gspread** + **google-auth**. PestaÃ±as: `pronosticos`, `resultados_oficiales`, `ranking`.
* **ConfiguraciÃ³n por entorno**: `DEADLINE` (ISO-UTC), `SHEETS_SPREADSHEET_ID`, `ALLOWED_ORIGINS`, credenciales del Service Account.
* **Validaciones**:

  * Deadline en el endpoint de escritura de pronÃ³sticos.
  * Chequeo contra listas de **fuerzas** y **provincias** cargadas desde archivos estÃ¡ticos.
  * Unicidad por **email** y ediciÃ³n permitida hasta el cierre.
* **Scoring**: motor interno que calcula puntaje principal (error absoluto ponderado, orden Top-3, participaciÃ³n y margen) y puntaje bonus (reglas fijas).
* **Observabilidad**: logging de sincronizaciÃ³n con Sheets y de reprocesos; mÃ©tricas bÃ¡sicas en `/api/admin/overview`. VÃ¡lidaciÃ³n visual de problemas simples.
* **CORS**: habilitado Ãºnicamente para el dominio del frontend; soporte a credenciales para la sesiÃ³n admin.
* **Despliegue**: contenedorizable; variables inyectadas por entorno; migraciones gestionadas por Django.

### Frontend (Vue.js 3)

* **Framework**: **Vue 3** (Composition API) con **TypeScript**.
* **Bundler**: **Vite**.
* **Estado global**: **Pinia** (stores para jugador, prode, resultados y administraciÃ³n).
* **Router**: **Vue Router** (rutas: Inicio, Prode con subtabs, Resultados, Ranking, AdministraciÃ³n).
* **UI**: **Vuetify** como framework de componentes (inputs, tablas, modales, alerts, layouts responsivos).
* **HTTP**: **Axios** con manejo de estados (cargando, Ã©xito, pendiente de sync) y tratamiento de 403 post-deadline.
* **Config por entorno**: `VITE_DEADLINE` (ISO-UTC), `VITE_API_BASE`.
* **UX**: validaciones suaves (rangos 0â€“100, suma â‰ˆ 100 %), **cuenta regresiva**, bloqueo visual post-deadline, precarga por email, buscador en ranking, exportaciÃ³n a CSV (vÃ­a API admin).
* **Acceso admin**: login de sesiÃ³n (form simple), vistas de carga de resultados, reintento de sincronizaciÃ³n y mÃ©tricas.

# ğŸ—³ï¸ PRODE ELECTORAL LEGISLATIVO 2025 â€” EspecificaciÃ³n reformulada y unificada

---

## 1ï¸âƒ£ Experiencia del usuario â€” quÃ© ve y quÃ© responde

### Inicio e identificaciÃ³n

El usuario ingresa al sitio y ve una **portada con cuenta regresiva** hasta el cierre del prode. Las acciones visibles son â€œJugarâ€, â€œResultadosâ€ y â€œRankingâ€; la pestaÃ±a â€œAdministraciÃ³nâ€ estÃ¡ oculta y solo accesible a staff.
Al presionar â€œJugarâ€, aparece un modal de **identificaciÃ³n mÃ­nima** con dos campos obligatorios:

* **Nombre de usuario** (texto libre UTF-8).
* **Email** (Ãºnico y con formato vÃ¡lido).

No hay registro ni contraseÃ±as. Si el correo ya participÃ³, se **precarga** su pronÃ³stico y puede **editarlo hasta el deadline**.

### PestaÃ±a â€œNacionalâ€

Presenta las preguntas **centrales** del prode, ligadas al puntaje principal.
El usuario debe:

* Ordenar el **Top-3** de fuerzas (desde la lista de fuerzas definidas en `fuerzas.json`).
* Asignar **porcentajes por fuerza nacional** (la suma debe ser â‰ˆ 100 %).
* Estimar el **porcentaje de participaciÃ³n**.
* Calcular el **margen entre 1.Âº y 2.Âº**.
* Completar el **voto blanco/nulo/impugnado**.

El frontend valida rangos (0â€“100 %) y coherencia, mostrando advertencias pero sin bloquear el avance.

### PestaÃ±a â€œProvincialesâ€

El usuario carga pronÃ³sticos para 8â€“12 provincias clave (extraÃ­das de `provincias.json`).
Para cada provincia:

* % por fuerza (solo las predefinidas).
* Fuerza dominante (selecciÃ³n Ãºnica).

La UI impide ingresar nombres de fuerzas o provincias no registradas.

### PestaÃ±a â€œBonus y especialesâ€

Campos de puntaje secundario:

* Provincia mÃ¡s reÃ±ida.
* Provincia que cambia de ganador respecto 2023.
* Donde **FIT** saca mayor %.
* Donde **LLA** mÃ¡s crece.
* Donde **Fuerza Patria** obtiene mayor %.

### PestaÃ±a â€œResumen y envÃ­oâ€

Muestra todo lo ingresado, el estado de sincronizaciÃ³n (â€œGuardado / Pendienteâ€), y un botÃ³n **Guardar** activo solo antes del cierre.

### Post-deadline

Cuando la cuenta regresiva llega a cero, las pestaÃ±as se vuelven **solo lectura** y aparece el cartel **â€œElecciones finalizadasâ€**.
El jugador aÃºn puede ver su pronÃ³stico, pero no modificarlo.

### Resultados y ranking

Antes de la publicaciÃ³n oficial: mensaje **â€œA la espera de resultados oficialesâ€**.
Luego:

* Panel **Nacional** con porcentajes reales.
* Panel **Provincial** con tabla de resultados por distrito.
* **Ranking general** con posiciÃ³n, usuario, puntaje total, medallas, bonus y fecha de envÃ­o.

El buscador permite filtrar por nombre o email.

### AdministraciÃ³n (staff con login de sesiÃ³n)

Acceso oculto en menÃº. Solo visible para usuarios con credenciales definidas en base o variables de entorno. Permite:

* Subir resultados oficiales.
* Ejecutar el **reprocesamiento de puntajes**.
* Reintentar sincronizaciones con Google Sheets.
* Exportar ranking a CSV.
* Ver mÃ©tricas del sistema (deadline, conteos, sincronizaciÃ³n, estado del cronÃ³metro).

---

## 2ï¸âƒ£ Flujo cronolÃ³gico del usuario

1. Ingresa al **inicio** y observa la cuenta regresiva.
2. Toca **Jugar**, completa nombre y email.
3. Avanza por **Nacional â†’ Provinciales â†’ Bonus**, completando cada secciÃ³n.
4. Revisa el **Resumen** y presiona **Guardar** antes del `DEADLINE`.
5. Si intenta guardar luego del cierre, ve â€œElecciones finalizadasâ€.
6. Cuando se publiquen resultados, puede acceder a **Resultados**, **Puntaje bonus** y **Ranking general**.

---

## 3ï¸âƒ£ Funcionamiento tÃ©cnico â€” soporte del flujo

* **Archivos estÃ¡ticos** (`fuerzas.json`, `provincias.json`) definen los Ãºnicos valores vÃ¡lidos; si un valor no coincide, el backend rechaza el envÃ­o.
* **Deadline** en variable de entorno (`DEADLINE` / `VITE_DEADLINE`, ISO-UTC); el **backend es autoridad final**.
* **Dual-write:** cada â€œGuardarâ€ persiste en **base relacional** (fuente de verdad) y refleja en **Google Sheets** (`pronosticos`).

  * Si falla Sheets, se marca `sync_pending = true` y se puede reintentar desde AdministraciÃ³n.
* **Unicidad por email:** antes del deadline, el envÃ­o **actualiza** si ya existe; despuÃ©s del cierre, la API responde 403.
* **Resultados oficiales:** cargados por staff; se guardan en base y en la hoja `resultados_oficiales`.
* **Scoring:** tras publicar resultados, el backend calcula **puntaje principal** (error absoluto sobre campos â€œimportantesâ€) y **bonus** (reglas fijas), y expone `/api/score` (estructuras reducidas, sin payloads sensibles).

---

## 4ï¸âƒ£ Diagrama integral del sistema

```
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚          Usuario             â”‚
             â”‚ (Inicio â†’ Jugar â†’ Prode)     â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                  [ SPA Vue Frontend ]
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 â”‚                 â”‚
  GET /api/predictions/mine â”‚  POST /api/predictions (deadline check)
 (precarga por email)        â”‚
          â”‚                 â”‚
          â–¼                 â–¼
     [BD principal]  â‡†  [Google Sheets: pronosticos]
                            â”‚
                     (sync_pending si falla)
                            â”‚
                            â–¼
            [Admin login â†’ POST /api/results]
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                   â–¼
 [BD: resultados_oficiales]       [Sheets: resultados_oficiales]
                            â”‚
                  Script de scoring backend
                            â–¼
          [BD: ranking_calculado] â‡† [Sheets: ranking]
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                                   â–¼
 [SPA: Resultados]                   [SPA: Ranking pÃºblico]
```

---

## 5ï¸âƒ£ TecnologÃ­as y arquitectura (backend y frontend)

### Backend (Django)

* **Framework**: **Django 5** con **Django REST Framework** para la API.
* **Base de datos**: **PostgreSQL** (o SQLite en desarrollo).
* **AutenticaciÃ³n administrativa**: **sesiones Django** con CSRF activo para la pestaÃ±a â€œAdministraciÃ³nâ€; usuarios `is_staff`.
* **DocumentaciÃ³n**: **drf-spectacular** (OpenAPI JSON y UI de docs).
* **SincronizaciÃ³n con Google Sheets**: **gspread** + **google-auth**. PestaÃ±as: `pronosticos`, `resultados_oficiales`, `ranking`.
* **ConfiguraciÃ³n por entorno**: `DEADLINE` (ISO-UTC), `SHEETS_SPREADSHEET_ID`, `ALLOWED_ORIGINS`, credenciales del Service Account.
* **Validaciones**:

  * Deadline en el endpoint de escritura de pronÃ³sticos.
  * Chequeo contra listas de **fuerzas** y **provincias** cargadas desde archivos estÃ¡ticos.
  * Unicidad por **email** y ediciÃ³n permitida hasta el cierre.
* **Scoring**: motor interno que calcula puntaje principal (error absoluto ponderado, orden Top-3, participaciÃ³n y margen) y puntaje bonus (reglas fijas).
* **Observabilidad**: logging de sincronizaciÃ³n con Sheets y de reprocesos; mÃ©tricas bÃ¡sicas en `/api/admin/overview`. VÃ¡lidaciÃ³n visual de problemas simples.
* **CORS**: habilitado Ãºnicamente para el dominio del frontend; soporte a credenciales para la sesiÃ³n admin.
* **Despliegue**: contenedorizable; variables inyectadas por entorno; migraciones gestionadas por Django.

### Frontend (Vue.js 3)

* **Framework**: **Vue 3** (Composition API) con **TypeScript**.
* **Bundler**: **Vite**.
* **Estado global**: **Pinia** (stores para jugador, prode, resultados y administraciÃ³n).
* **Router**: **Vue Router** (rutas: Inicio, Prode con subtabs, Resultados, Ranking, AdministraciÃ³n).
* **UI**: **Vuetify** como framework de componentes (inputs, tablas, modales, alerts, layouts responsivos).
* **HTTP**: **Axios** con manejo de estados (cargando, Ã©xito, pendiente de sync) y tratamiento de 403 post-deadline.
* **Config por entorno**: `VITE_DEADLINE` (ISO-UTC), `VITE_API_BASE`.
* **UX**: validaciones suaves (rangos 0â€“100, suma â‰ˆ 100 %), **cuenta regresiva**, bloqueo visual post-deadline, precarga por email, buscador en ranking, exportaciÃ³n a CSV (vÃ­a API admin).
* **Acceso admin**: login de sesiÃ³n (form simple), vistas de carga de resultados, reintento de sincronizaciÃ³n y mÃ©tricas.
